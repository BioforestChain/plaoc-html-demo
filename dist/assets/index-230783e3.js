var me=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var E=(n,e,t)=>(me(n,e,"read from private field"),t?t.call(n):e.get(n)),N=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},L=(n,e,t,s)=>(me(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t);var ke=(n,e,t,s)=>({set _(r){L(n,e,r,t)},get _(){return E(n,e,s)}}),et=(n,e,t)=>(me(n,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();const o=(n,e,t)=>{const s=t.value;if(typeof s!="function")throw new Error(`${n}.${e} should be function`);return t.get=function(){const r=s.bind(this);return delete t.get,t.value=r,t.writable=!0,Object.defineProperty(this,e,t),r},delete t.value,delete t.writable,t},se=()=>new At;class At{constructor(){this._cbs=new Set,this.listen=e=>(this._cbs.add(e),()=>this._cbs.delete(e)),this.emit=(...e)=>{for(const t of this._cbs)t.apply(null,e)},this.clear=()=>{this._cbs.clear()}}}const Ne=()=>n=>n,Lt=Ne()({async number(){return+await this.text()},async ok(){const n=await this;if(n.status>=400)throw n.statusText||await n.text();return n},async text(){return(await this.ok()).text()},async binary(){return(await this.ok()).arrayBuffer()},async boolean(){return await this.text()==="true"},async object(){const n=await this.ok();try{return await n.json()}catch(e){console.error("fail to object",n.url);debugger;throw e}}});class at extends TransformStream{constructor(e=t=>t){let t="";const s=(r,a)=>{try{r.enqueue(e(JSON.parse(a)))}catch(i){return r.error(i),!0}};super({transform:(r,a)=>{t+=r;let i;for(;(i=t.indexOf(`
`))!==-1;){const l=t.slice(0,i);if(t=t.slice(l.length+1),s(a,l))break}},flush:r=>{t=t.trim(),t.length>0&&s(r,t),r.terminate()}})}}const jt=Ne()({async jsonlines(n){return(await this.stream()).pipeThrough(new TextDecoderStream).pipeThrough(new at(n))},stream(){return this.then(n=>{const e=n.body;if(e==null)throw new Error(`request ${n.url} could not by stream.`);return e})}}),$t={...Lt,...jt};function xt(n){const e=n.method;let t="";return e===je.GET||e===je.HEAD?new Request(n.url,{method:e,headers:n.headers}):(n.body&&(t=n.body),new Request(`${n.url}`,{method:e,headers:n.headers,body:t}))}function tt(n,e){const t=e==null?void 0:e.search;if(t){let s;t instanceof URLSearchParams?s=t:typeof t=="string"?s=new URLSearchParams(t):s=new URLSearchParams(Object.entries(t).filter(([r,a])=>a!=null).map(([r,a])=>[r,typeof a=="object"?JSON.stringify(a):String(a)])),s.forEach((r,a)=>{n.searchParams.append(a,r)})}return Object.assign(new Request(n,e),Ne()({fetch(){return Object.assign(fetch(this),$t)}}))}const Me=class Ce{constructor(e){this.mmid=e,this.createSignal=se}static get url(){return typeof this.public_url=="string"&&this.public_url!==""&&this.internal_url_useable!==!0?this.public_url:this.internal_url}fetchApi(e,t){return this.buildApiRequest(e,t).fetch()}buildApiRequest(e,t){const s=new URL((t==null?void 0:t.base)??Ce.url);return s.pathname=`${this.mmid}${e}`,tt(s,t)}buildExternalApiRequest(e,t){const s=new URL((t==null?void 0:t.base)??Ce.url);return s.pathname=e,tt(s,t)}};var nt;Me.internal_url=((nt=globalThis.location)==null?void 0:nt.href)??"http://localhost";Me.public_url="";let h=Me;var ne=(n=>(n.UPC_A="UPC_A",n.UPC_E="UPC_E",n.UPC_EAN_EXTENSION="UPC_EAN_EXTENSION",n.EAN_8="EAN_8",n.EAN_13="EAN_13",n.CODE_39="CODE_39",n.CODE_39_MOD_43="CODE_39_MOD_43",n.CODE_93="CODE_93",n.CODE_128="CODE_128",n.CODABAR="CODABAR",n.ITF="ITF",n.ITF_14="ITF_14",n.AZTEC="AZTEC",n.DATA_MATRIX="DATA_MATRIX",n.MAXICODE="MAXICODE",n.PDF_417="PDF_417",n.QR_CODE="QR_CODE",n.RSS_14="RSS_14",n.RSS_EXPANDED="RSS_EXPANDED",n))(ne||{}),X=(n=>(n.UserReject="UserReject",n.UserAgree="UserAgree",n.UserError="UserError",n))(X||{}),Ut=Object.defineProperty,Bt=Object.getOwnPropertyDescriptor,He=(n,e,t,s)=>{for(var r=s>1?void 0:s?Bt(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&Ut(e,t,r),r};class ue extends h{constructor(){super("barcode-scanning.sys.dweb")}async process(e,t=0,s=ne.QR_CODE){const r=await this.buildApiRequest("/process",{search:{rotation:t,formats:s},method:"POST",body:e,base:await h.public_url}).fetch().object();return Array.from(r??[])}async stop(){return await this.fetchApi("/stop").boolean()}async getSupportedFormats(){return(await this.fetchApi("/get_supported_formats")).json()}}He([o],ue.prototype,"process",1);He([o],ue.prototype,"stop",1);He([o],ue.prototype,"getSupportedFormats",1);const it=new ue,c=()=>(n,e,t)=>{const s=t.get;if(s===void 0)throw new Error(`${n}.${e} should has getter`);return t.get=function(){const r=s.call(this);return t.set?t.get=()=>r:(delete t.set,delete t.get,t.value=r,t.writable=!1),Object.defineProperty(this,e,t),r},t};var re=(n=>(n.FRONT="user",n.BACK="environment",n))(re||{});class Ie{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t}).then(e=>(this._value=e,e))}static resolve(e){const t=new Ie;return t.resolve(e),t}get value(){return this._value}}let _=self.__native_close_watcher_kit__;var ce;if(_)_._watchers??(_._watchers=new Map),_._tasks??(_._tasks=new Map);else if("webkit"in globalThis)Object.assign(globalThis,{__native_close_watcher_kit__:{registryToken(n){try{globalThis.webkit.messageHandlers.closeWatcher.postMessage({token:n})}catch{}},tryClose(n){try{globalThis.webkit.messageHandlers.closeWatcher.postMessage({id:n})}catch{}},_watchers:new Map,_tasks:new Map}}),_=self.__native_close_watcher_kit__;else{const n=new Set,e=new Array,r=class r{constructor(){this._destoryed=!1,this.id=`#cw-${ke(r,ce)._++}`}tryClose(){var i;return this._destoryed?!1:((i=_._watchers.get(this.id))==null||i.dispatchEvent(new CloseEvent("close")),this._destoryed=!0,!0)}};ce=new WeakMap,N(r,ce,0);let t=r;const s=new class{apply(i){if(i||e.length===0){const l=new t;e.push(l)}return e.at(-1)}resolveToken(i,l){var u;(u=_._tasks.get(i))==null||u(l.id)}get canClose(){return e.length>0}close(i=e.at(-1)){if(i!=null&&i.tryClose()){const l=e.indexOf(i);if(l!==-1)return e.splice(l,1),!0}return!1}};typeof navigation=="object"&&navigation.addEventListener("navigate",a=>{s.canClose&&a.intercept({async hanlder(){s.close()}})}),document.addEventListener("keypress",a=>{a.key==="Escape"&&(console.log("Esc键被按下"),s.close())}),Object.assign(globalThis,{__native_close_watcher_kit__:{async registryToken(a){if(n.add(a),await(await fetch(a)).text()==="create-close-watcher"){const i=s.apply(navigator.userActivation.isActive);s.resolveToken(a,i)}},tryClose(a){for(const i of e.slice())i.id===a&&s.close(i)},_watchers:new Map,_tasks:new Map}}),_=self.__native_close_watcher_kit__}var R,le,ot,j;class Nt extends EventTarget{constructor(){super();N(this,le);N(this,R,void 0);N(this,j,void 0);L(this,R,new Ie),this._closed=!1,et(this,le,ot).call(this)}async close(){if(this._closed)return;const t=await E(this,R).promise;self.__native_close_watcher_kit__.tryClose(t)}get onclose(){return E(this,j)??null}set onclose(t){typeof t=="function"?L(this,j,t):L(this,j,void 0)}addEventListener(){return super.addEventListener(...arguments)}removeEventListener(){return super.addEventListener(...arguments)}}R=new WeakMap,le=new WeakSet,ot=async function(){const t=URL.createObjectURL(new Blob(["create-close-watcher"],{type:"text/html"})),s=self.__native_close_watcher_kit__,r=s._tasks,a=E(this,R);r.set(t,a.resolve),s.registryToken(t);const i=await a.promise;r.delete(t),s._watchers.set(i,this),console.log("close watcher created"),this.addEventListener("close",l=>{var u;console.log("close watcher closed"),(u=E(this,j))==null||u.call(this,l),s._watchers.delete(i),this._closed=!0},{once:!0})},j=new WeakMap;typeof self.CloseWatcher>"u"&&Object.assign(self,{CloseWatcher:Nt});const Mt=self.CloseWatcher;var Ht=Object.defineProperty,It=Object.getOwnPropertyDescriptor,Re=(n,e,t,s)=>{for(var r=s>1?void 0:s?It(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&Ht(e,t,r),r};class q extends HTMLElement{constructor(){super(),this.plugin=it,this._video=null,this._canvas=null,this._formats=ne.QR_CODE,this._direction=re.BACK,this._activity=!1,this._isCloceLock=!1,this.createClose()}createClose(){const e=new Mt;this._isCloceLock=!0,e.addEventListener("close",t=>{this._isCloceLock=!1,this._activity&&this.stopScanning()})}get getView(){return this._video?this._video.parentElement:null}get process(){return this.plugin.process}get stop(){return this.plugin.stop}async startScanning(e=0,t=ne.QR_CODE){this._isCloceLock||this.createClose(),await this.createElement();const s=await this._startVideo();let r=[];return s===X.UserAgree&&(r=await this.taskPhoto(e,t)),{hasContent:r.length!==0,content:r,permission:s}}stopScanning(){this._activity=!1,this.stopCamera("user stop")}stopCamera(e){console.error(e),this._stop()}taskPhoto(e,t){return this._activity=!0,new Promise((s,r)=>{const a=()=>{if(!this._canvas)return console.error("service close！"),s([]);if(!this._activity)return console.error("user close！"),s([]);this._canvas.toBlob(async i=>{if(i){const l=await this.plugin.process(i,e,t).then(Ye=>Ye).catch(()=>(this._activity=!1,r("502 service error"))),u=Array.from(l??[]);return u.length>0?(this.stopCamera(u),this._activity=!1,s(u)):a()}},"image/jpeg",.5)};a()})}async _startVideo(){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){const e={video:{facingMode:this._direction}};return await navigator.mediaDevices.getUserMedia(e).then(async t=>(await this.gotMedia(t),X.UserAgree)).catch(t=>(console.error("You need to authorize the camera permission to use the scan code!",t),this.stopScanning(),X.UserReject))}else return this.stopScanning(),console.error("Your browser does not support scanning code!"),X.UserError}async gotMedia(e){var s,r;if(!this._video)throw new Error("not create video");if(this._video.srcObject=e,e.getVideoTracks().length>0&&this._canvas){this._canvas.captureStream(100);const a=this._canvas.getContext("2d"),i=()=>requestAnimationFrame(()=>{var l,u;a&&this._video&&(a.drawImage(this._video,0,0,((l=this._canvas)==null?void 0:l.width)??480,((u=this._canvas)==null?void 0:u.height)??360),i())});i()}await this._video.play(),(r=(s=this._video)==null?void 0:s.parentElement)==null||r.setAttribute("style",`
      position:fixed; top: 0; left: 0; width:100%; height: 100%; background-color: black;
      -webkit-transition:all 0.2s linear;
      -moz-transition:all 0.2s linear;
      -ms-transition:all 0.2s linear;
      -o-transition:all 0.2s linear;
      transition:all 0.2s linear;
      visibility: visible;`)}_stop(){var e,t;if(this._video){this._video.pause();const s=this._video.srcObject;if(s){const r=s.getTracks();for(let a=0;a<r.length;a++)r[a].stop()}(e=this._video.parentElement)==null||e.remove(),this._video=null}this._canvas&&((t=this._canvas.getContext("2d"))==null||t.clearRect(0,0,this._canvas.width,this._canvas.height),this._canvas=null)}createElement(e=re.BACK){return new Promise((t,s)=>{const r=document.body,a=document.getElementById("video"),i=document.getElementById("canvas");if(a)return s("camera already started"),{message:"camera already started"};const l=document.createElement("div");l.setAttribute("style","position:fixed; top: 0; left: 0; width:100%; height: 100%; background-color: black;visibility: hidden;"),this._video=document.createElement("video"),this._video.id="video",e!==re.BACK?this._video.setAttribute("style","-webkit-transform: scaleX(-1); transform: scaleX(-1); width:100%; height: 100%;"):this._video.setAttribute("style","width:100%; height: 100%;"),this._video.setAttribute("autoplay","true");const u=navigator.userAgent.toLowerCase();u.includes("safari")&&!u.includes("chrome")&&(this._video.setAttribute("muted","true"),this._video.setAttribute("playsinline","true")),l.appendChild(this._video),i||(this._canvas=document.createElement("canvas"),this._canvas.setAttribute("style","visibility: hidden;"),this._canvas.width=480,this._canvas.height=360,this._canvas.id="canvas",l.appendChild(this._canvas)),r.appendChild(l),t(!0)})}getSupportedFormats(){return this.plugin.getSupportedFormats()}}q.tagName="dweb-barcode-scanning";Re([c()],q.prototype,"getView",1);Re([c()],q.prototype,"process",1);Re([c()],q.prototype,"stop",1);customElements.define(q.tagName,q);var Rt=Object.defineProperty,qt=Object.getOwnPropertyDescriptor,ct=(n,e,t,s)=>{for(var r=s>1?void 0:s?qt(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&Rt(e,t,r),r};class qe extends h{constructor(){super("biometrics.sys.dweb")}async check(){return await this.fetchApi("/check").boolean()}async biometrics(){return await this.fetchApi("/biometrics").object()}}ct([o],qe.prototype,"check",1);ct([o],qe.prototype,"biometrics",1);const Vt=new qe;var Wt=Object.defineProperty,Xt=Object.getOwnPropertyDescriptor,lt=(n,e,t,s)=>{for(var r=s>1?void 0:s?Xt(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&Wt(e,t,r),r};class K extends HTMLElement{constructor(){super(...arguments),this.plugin=Vt}get check(){return this.plugin.check}get biometrics(){return this.plugin.biometrics}}K.tagName="dweb-biometrics";lt([c()],K.prototype,"check",1);lt([c()],K.prototype,"biometrics",1);customElements.define(K.tagName,K);var Kt=Object.defineProperty,Gt=Object.getOwnPropertyDescriptor,p=(n,e,t,s)=>{for(var r=s>1?void 0:s?Gt(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&Kt(e,t,r),r};class he extends h{constructor(){super("bluetooth.std.dweb"),this._watch=()=>{const e=new URL(h.url.replace(/^http:/,"ws:").replace(/^https:/,"wss:"));e.pathname=`${this.mmid}/watch`;const t=new WebSocket(e);this._ws=t,t.onerror=s=>{console.error("onerror",s)},t.onopen=()=>{},t.onmessage=async s=>{try{if((await s.data.text()).length===0)return;const a=JSON.parse(await s.data.text()),i=this._allListener.get(a.type);if(i===void 0)return;i(a)}catch(r){console.error("_watchGattServerDisconnected","ws.onmessage error",r)}},t.onclose=()=>{console.log("关闭了","需要把消息发送给监听者")}},this._allListener=new Map}async open(){const e=(await this.fetchApi("/open")).json();return this._watch(),e}async close(){const e=(await this.fetchApi("/close")).json();return this._ws&&(this._ws.close(),this._ws=void 0),e}async requestAndConnectDevice(e={acceptAllDevices:!0,optionalServices:["00003802-0000-1000-8000-00805f9b34fb"]}){const t=await(await this.fetchApi("/request_connect_device",{method:"POST",body:JSON.stringify(e)})).json();return t.success&&(t.data=new pe(this,new F(this,t.data.device.id,!0,t.data.device.name))),t}addeEventListener(e,t){this._allListener.set(e,t)}}p([o],he.prototype,"open",1);p([o],he.prototype,"close",1);p([o],he.prototype,"requestAndConnectDevice",1);class F{constructor(e,t,s,r,a){this.plugin=e,this.id=t,this.watchingAdvertisements=s,this.eventMap=new Map,this.gettserverdisconnectedListener=()=>{const i=this.eventMap.get("gattserverdisconnected");i!==void 0&&i.forEach(l=>{l.bind(this)(new zt)})},this.advertisementreceivedListener=i=>{const l=this.eventMap.get("advertisementreceived");l!==void 0&&l.forEach(u=>{u.bind(this)(i)})},this.name=r,this.gatt=a,this.plugin.addeEventListener("gattserverdisconnected",this.gettserverdisconnectedListener),this.plugin.addeEventListener("advertisementreceived",this.advertisementreceivedListener)}async forget(){return await(await this.plugin.fetchApi("/bluetooth_device/forget",{search:{id:this.id}})).json()}async watchAdvertisements(){return await(await this.plugin.fetchApi("/bluetooth_device/watch_advertisements",{search:{id:this.id}})).json()}addEventListener(e,t){let s=this.eventMap.get(e);s===void 0&&(s=new Set,this.eventMap.set(e,s)),s.add(t)}removeEventListener(e,t){const s=this.eventMap.get(e);s!==void 0&&s.delete(t)}}p([o],F.prototype,"forget",1);p([o],F.prototype,"watchAdvertisements",1);p([o],F.prototype,"addEventListener",1);p([o],F.prototype,"removeEventListener",1);class pe{constructor(e,t,s=!0){this.plugin=e,this.device=t,this.connected=!1,this.connected=s}async connect(){return(await(await this.plugin.fetchApi("/bluetooth_remote_gatt_server/connect",{search:{id:this.device.id}})).json()).success===!0&&(this.connected=!0),console.log("再次连接"),this}async disconnect(){return(await(await this.plugin.fetchApi("/bluetooth_remote_gatt_server/disconnect",{search:{id:this.device.id}})).json()).success===!0&&(this.connected=!1),this}async getPrimaryService(e){const t=await(await this.plugin.fetchApi("/bluetooth_remote_gatt_server/get_primary_service",{search:{uuid:e}})).json();if(t.success===!0){console.log("success",t.data);const s=new ut(this.plugin,t.data.device,t.data.uuid,t.data.isPrimary);t.data=s}return t}}p([o],pe.prototype,"connect",1);p([o],pe.prototype,"disconnect",1);p([o],pe.prototype,"getPrimaryService",1);class ut extends EventTarget{constructor(e,t,s,r){super(),this.plugin=e,this.device=t,this.uuid=s,this.isPrimary=r}async getCharacteristic(e){const t=await(await this.plugin.fetchApi("/bluetooth_remote_gatt_service/get_characteristic",{search:{uuid:e}})).json();return t.success&&(t.data=new ge(this.plugin,this,t.data.uuid,t.data.properties,t.data.value?t.data.value:void 0)),t}}p([o],ut.prototype,"getCharacteristic",1);class ge{constructor(e,t,s,r,a){this.plugin=e,this.service=t,this.uuid=s,this.properties=r,this.value=a,this.eventMap=new Map,this.characteristicvaluechangedListener=i=>{const l=this.eventMap.get("characteristicvaluechanged");l!==void 0&&l.forEach(u=>{u.bind(this)(i)})},this.addEventListener=(i,l)=>{let u=this.eventMap.get(i);u===void 0&&(u=new Set,this.eventMap.set(i,u)),u.add(l)},this.removeEvent=(i,l)=>{const u=this.eventMap.get(i);u!==void 0&&u.delete(l)},this.plugin.addeEventListener("characteristicvaluechanged",this.characteristicvaluechangedListener)}async readValue(){const e=await(await this.plugin.fetchApi("/bluetooth_remote_gatt_characteristic/read_value")).json();return e.success&&(e.data=new DataView(Uint8Array.from([...Object.values(e.data)]).buffer)),e}async writeValue(e){return await(await this.plugin.fetchApi("/bluetooth_remote_gatt_characteristic/write_value",{method:"POST",body:new Blob([e]),headers:{"Content-Type":"application/octet-stream"}})).json()}async getDescriptor(e){const t=await(await this.plugin.fetchApi("/bluetooth_remote_gatt_characteristic/get_descriptor",{search:{uuid:e}})).json();return t.success&&(t.data=new Ve(this,e,t.data.value)),t}}p([o],ge.prototype,"readValue",1);p([o],ge.prototype,"writeValue",1);p([o],ge.prototype,"getDescriptor",1);class Ve{constructor(e,t,s){this.characteristic=e,this.uuid=t,this.value=s}async readValue(){const e=await(await this.characteristic.plugin.fetchApi("/bluetooth_remote_gatt_descriptor/reaed_value")).json();return e.success&&(e.data=new DataView(Uint8Array.from([...Object.values(e.data)]).buffer)),e}async writeValue(e){return await(await this.characteristic.plugin.fetchApi("/bluetooth_remote_gatt_descriptor/write_value",{method:"POST",body:new Blob([e]),headers:{"Content-Type":"application/octet-stream"}})).json()}}p([o],Ve.prototype,"readValue",1);p([o],Ve.prototype,"writeValue",1);const Jt=new he;class zt extends Event{constructor(){super("gattserverdisconnected"),this.state="disconnected"}}class De extends HTMLElement{constructor(){super(...arguments),this.plugin=Jt}async open(){return await this.plugin.open()}async close(){return await this.plugin.close()}async requestAndConnectDevice(e){return await this.plugin.requestAndConnectDevice(e)}}De.tagName="dweb-bluetooth";customElements.define(De.tagName,De);var Ft=Object.defineProperty,Zt=Object.getOwnPropertyDescriptor,Qt=(n,e,t,s)=>{for(var r=s>1?void 0:s?Zt(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&Ft(e,t,r),r};class ht extends h{constructor(){super("camera.sys.dweb"),this.tagName="dweb-camera"}async getPhoto(e){return await this.fetchApi("/getPhoto",{search:{resultType:e.resultType,source:e.source,quality:e.quality}}).binary()}}Qt([o],ht.prototype,"getPhoto",1);new ht;var Te=(n=>(n.EMULATOR="X-Plaoc-Emulator",n.PROXY="X-Plaoc-Proxy",n.API_INTERNAL_URL="X-Plaoc-Internal-Url",n.API_PUBLIC_URL="X-Plaoc-Public-Url",n.EXTERNAL_URL="X-Plaoc-External-Url",n.SESSION_ID="X-Plaoc-Session-Id",n))(Te||{});class Yt extends h{constructor(){super("internal"),typeof location=="object"&&this.initConfig()}initConfig(e=location.href){const t=new URL(e).searchParams,s=t.get(Te.API_INTERNAL_URL),r=t.get(Te.API_PUBLIC_URL);r&&this.setPublicUrl(r),s&&this.setInternalUrl(s)}getInternalUrl(){return h.internal_url}setInternalUrl(e){try{return h.internal_url=e}finally{}}setPublicUrl(e){return h.public_url=e}get public_url(){return h.public_url}}const Pe=new Yt;class Ae extends HTMLElement{constructor(){super(...arguments),this.plugin=Pe}get public_url(){return Pe.public_url}static get observedAttributes(){return["api-url"]}attributeChangedCallback(e,t,s){e==="api-url"&&Pe.setInternalUrl(s)}}Ae.tagName="dweb-config";customElements.define(Ae.tagName,Ae);var kt=Object.defineProperty,er=Object.getOwnPropertyDescriptor,tr=(n,e,t,s)=>{for(var r=s>1?void 0:s?er(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&kt(e,t,r),r};class pt extends h{constructor(){super("device.sys.dweb")}getUUID(){return this.fetchApi("/uuid").object()}}tr([o],pt.prototype,"getUUID",1);const rr=new pt;class Le extends HTMLElement{constructor(){super(...arguments),this.plugin=rr}getUUID(){return this.plugin.getUUID()}}Le.tagName="dweb-device";customElements.define(Le.tagName,Le);var sr=Object.defineProperty,nr=Object.getOwnPropertyDescriptor,C=(n,e,t,s)=>{for(var r=s>1?void 0:s?nr(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&sr(e,t,r),r};class Z extends h{constructor(){super("jmm.browser.dweb"),this.tagName="dweb-update-controller",this.progressNum=0}async init(){}async download(e){return await this.fetchApi("/install",{search:{metadataUrl:e}}).object()}async pause(){return await this.fetchApi("/pause").boolean()}async resume(){return await this.fetchApi("/resume").boolean()}async cancel(){return await this.fetchApi("/cancel").boolean()}}C([o],Z.prototype,"download",1);C([o],Z.prototype,"pause",1);C([o],Z.prototype,"resume",1);C([o],Z.prototype,"cancel",1);class Q extends h{constructor(){super("dns.std.dweb"),this.tagName="dweb-service-worker",this.updateController=new Z}update(){return this.updateController}async close(){return await this.fetchApi("/close").boolean()}async restart(){return await this.fetchApi("/restart").boolean()}async externalFetch(e,t){let s=await h.public_url;s=s.replace("X-Dweb-Host=api","X-Dweb-Host=external");const r=new URL(location.href).searchParams.get("X-Plaoc-External-Url"),a=Object.assign(t.search??{},{mmid:e,action:"request",pathname:t.pathname}),i=Object.assign(t,{search:a,base:s});return await this.buildExternalApiRequest(`/${r}`,i).fetch()}}C([o],Q.prototype,"update",1);C([o],Q.prototype,"close",1);C([o],Q.prototype,"restart",1);C([o],Q.prototype,"externalFetch",1);const I=new Q;class gt extends Event{constructor(e,t){super(e),this.plugin=I,this.public_url=h.public_url,this.request=t.request,this.clientId=t.clientId||null}async fetch(e,t){return await this.plugin.buildExternalApiRequest(e,t).fetch()}async respondWith(e){if(!this.public_url)throw Error("you need init <web-config></dweb-config>");const s=new URL(await h.public_url).href.replace(/X-Dweb-Host=api/,"X-Dweb-Host=external"),r=new URL(location.href).searchParams.get("X-Plaoc-External-Url");return this.fetch(`/${r}`,{method:"POST",search:{id:this.clientId,action:"response"},body:e,base:s})}}typeof globalThis.FetchEvent>"u"&&Object.assign(globalThis,{FetchEvent:gt});async function*ar(n){try{for(;;){const e=await n.read();if(e.done)break;yield e.value}}finally{n.releaseLock()}}const dt=(n,e={})=>ar(n.getReader());class ir{constructor(e){this.strategy=e,this.stream=new ReadableStream({cancel:t=>{var s;(s=this._on_cancel_signal)==null||s.emit(t)},start:t=>{this.controller=t},pull:()=>{var t;(t=this._on_pull_signal)==null||t.emit()}},this.strategy)}get onCancel(){return(this._on_cancel_signal??(this._on_cancel_signal=se())).listen}get onPull(){return(this._on_pull_signal??(this._on_pull_signal=se())).listen}}class We extends EventTarget{constructor(e){super(),this.app_kit=e}addEventListener(e,t,s){this.app_kit._listeners[e]||(this.app_kit._listeners[e]=[]),this.app_kit._listeners[e].push(t);const a=this.app_kit._windowListeners[e];a&&!a.registered&&this.addWindowListener(a,s);const i=()=>this.removeEventListener(e,t),l=Promise.resolve({remove:i});return Object.defineProperty(l,"remove",{value:()=>{console.warn("Using addListener() without 'await' is deprecated."),i()}}),l}addWindowListener(e,t){super.addEventListener(e.windowEventName,e.handler,t),e.registered=!0}removeEventListener(e,t,s){const r=this.app_kit._listeners[e];if(!r)return;const a=r.indexOf(t);this.app_kit._listeners[e].splice(a,1),this.app_kit._listeners[e].length||this.removeWindowListener(this.app_kit._windowListeners[e],s)}removeWindowListener(e,t){e&&(super.removeEventListener(e.windowEventName,e.handler,t),e.registered=!1)}hasListeners(e){return!!this.app_kit._listeners[e].length}notifyListeners(e,t){const s=this.app_kit._listeners[e];s&&s.forEach(r=>r(t))}}var or=Object.defineProperty,cr=Object.getOwnPropertyDescriptor,D=(n,e,t,s)=>{for(var r=s>1?void 0:s?cr(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&or(e,t,r),r};globalThis.__app_upgrade_watcher_kit__={};const S=globalThis.__app_upgrade_watcher_kit__;S&&(S._listeners??(S._listeners={}),S._windowListeners??(S._windowListeners={}));class V extends We{constructor(){super(S),this.plugin=I,this.updateContoller=new W,this.decodeFetch=e=>new gt("fetch",{request:xt(e),clientId:e.req_id.toString()})}get externalFetch(){return this.plugin.externalFetch}get update(){return this.updateContoller}get close(){return this.plugin.close}get restart(){return this.plugin.restart}async*registerEvent(e,t){let s=await h.public_url;s=s.replace("X-Dweb-Host=api","X-Dweb-Host=external");const r=new URL(location.href).searchParams.get("X-Plaoc-External-Url");console.log("addEventListener fetch",r);const a=await this.plugin.buildExternalApiRequest(`/${r}`,{search:{mmid:this.plugin.mmid,action:"listen"},base:s}).fetch().jsonlines(this.decodeFetch);for await(const i of dt(a,t))this.notifyListeners(e,i),yield i}addEventListener(e,t,s){return e==="fetch"&&(async()=>{for await(const r of this.registerEvent(e));})(),super.addEventListener(e,t,s)}removeEventListener(e,t,s){return super.removeEventListener(e,t,s)}}D([c()],V.prototype,"externalFetch",1);D([c()],V.prototype,"update",1);D([c()],V.prototype,"close",1);D([c()],V.prototype,"restart",1);class W extends We{constructor(){super(S)}get download(){return I.update().download}get pause(){return I.update().pause}get resume(){return I.update().resume}get cancel(){return I.update().cancel}addEventListener(e,t,s){return super.addEventListener(e,t,s)}removeEventListener(e,t,s){return super.removeEventListener(e,t,s)}}D([c()],W.prototype,"download",1);D([c()],W.prototype,"pause",1);D([c()],W.prototype,"resume",1);D([c()],W.prototype,"cancel",1);const vt=new V;typeof globalThis.DwebServiceWorker>"u"&&Object.assign(globalThis,{DwebServiceWorker:V});typeof globalThis.UpdateController>"u"&&Object.assign(globalThis,{UpdateController:W});var je=(n=>(n.GET="GET",n.POST="POST",n.PUT="PUT",n.DELETE="DELETE",n.OPTIONS="OPTIONS",n.TRACE="TRACE",n.PATCH="PATCH",n.PURGE="PURGE",n.HEAD="HEAD",n))(je||{}),lr=Object.defineProperty,ur=Object.getOwnPropertyDescriptor,T=(n,e,t,s)=>{for(var r=s>1?void 0:s?ur(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&lr(e,t,r),r};const P=class $e extends h{constructor(){super($e.isIOSDWebBrowser?"haptics.browser.dweb":"haptics.sys.dweb")}async impactLight(e){return await this.fetchApi("/impactLight",{search:{style:e.style}})}async notification(e){return await this.fetchApi("/notification",{search:{style:e.type}})}async vibrateClick(){return await this.fetchApi("/vibrateClick")}async vibrateDisabled(){return await this.fetchApi("/vibrateDisabled")}async vibrateDoubleClick(){return await this.fetchApi("/vibrateDoubleClick")}async vibrateHeavyClick(){return await this.fetchApi("/vibrateHeavyClick")}async vibrateTick(){return await this.fetchApi("/vibrateTick")}async vibrate(e){const t=(e==null?void 0:e.duration)||[300];return await this.fetchApi("/customize",{search:{duration:JSON.stringify(t)}})}fetchApi(e,t){return $e.isIOSDWebBrowser?globalThis.webkit.messageHandlers.haptics.postMessage({path:e,search:t==null?void 0:t.search}):this.buildApiRequest(e,t).fetch()}};P.isIOSDWebBrowser="webkit"in globalThis&&typeof globalThis.webkit.messageHandlers.haptics.postMessage=="function";T([o],P.prototype,"impactLight",1);T([o],P.prototype,"notification",1);T([o],P.prototype,"vibrateClick",1);T([o],P.prototype,"vibrateDisabled",1);T([o],P.prototype,"vibrateDoubleClick",1);T([o],P.prototype,"vibrateHeavyClick",1);T([o],P.prototype,"vibrateTick",1);T([o],P.prototype,"vibrate",1);let hr=P;const pr=new hr;var gr=Object.defineProperty,dr=Object.getOwnPropertyDescriptor,A=(n,e,t,s)=>{for(var r=s>1?void 0:s?dr(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&gr(e,t,r),r};class w extends HTMLElement{constructor(){super(...arguments),this.plugin=pr}get vibrate(){return this.plugin.vibrate}get impactLight(){return this.plugin.impactLight}get notification(){return this.plugin.notification}get vibrateClick(){return this.plugin.vibrateClick}get vibrateDisabled(){return this.plugin.vibrateDisabled}get vibrateDoubleClick(){return this.plugin.vibrateDoubleClick}get vibrateHeavyClick(){return this.plugin.vibrateHeavyClick}get vibrateTick(){return this.plugin.vibrateTick}}w.tagName="dweb-haptics";A([c()],w.prototype,"vibrate",1);A([c()],w.prototype,"impactLight",1);A([c()],w.prototype,"notification",1);A([c()],w.prototype,"vibrateClick",1);A([c()],w.prototype,"vibrateDisabled",1);A([c()],w.prototype,"vibrateDoubleClick",1);A([c()],w.prototype,"vibrateHeavyClick",1);A([c()],w.prototype,"vibrateTick",1);customElements.define(w.tagName,w);var vr=Object.defineProperty,fr=Object.getOwnPropertyDescriptor,de=(n,e,t,s)=>{for(var r=s>1?void 0:s?fr(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&vr(e,t,r),r};class Y extends h{constructor(){super("mwebview.browser.dweb")}open(e){return this.fetchApi("/open",{search:{url:e}}).object()}close(e){return this.fetchApi("/close",{search:{webview_id:e}}).boolean()}activate(){return this.fetchApi("/activate").boolean()}closeApp(){return this.fetchApi("/close/app").boolean()}}de([o],Y.prototype,"open",1);de([o],Y.prototype,"close",1);de([o],Y.prototype,"activate",1);de([o],Y.prototype,"closeApp",1);const yr=new Y;class xe extends HTMLElement{constructor(){super(...arguments),this.plugin=yr}open(e){return this.plugin.open(e)}close(e){return this.plugin.close(e)}activate(){return this.plugin.activate()}closeApp(){return this.plugin.closeApp()}}xe.tagName="dweb-mwebview";customElements.define(xe.tagName,xe);function ae(n){var t;const e=[0,0,0,255];if(n.startsWith("rgb")){const s=(t=n.match(/\((.+)\)/))==null?void 0:t[1].match(/\d+/g);if(s)for(const[r,a]of s.entries()){const i=parseFloat(a);switch(r){case 0:e[r]=i;break;case 1:e[r]=i;break;case 2:e[r]=i;break;case 3:e[r]=i*255;break}}}else n.startsWith("#")&&(n=n.slice(1),n.length===8||n.length===6?n.match(/../g).forEach((s,r)=>{e[r]=parseInt(s,16)}):(n.length===4||n.length===3)&&n.match(/./g).forEach((s,r)=>{e[r]=parseInt(s+s,16)}));return{red:e[0],green:e[1],blue:e[2],alpha:e[3]}}var Xe=(n=>(n[n.HEXA=0]="HEXA",n[n.RGBA=1]="RGBA",n))(Xe||{});function ft(n,e=1){const t=[n.red,n.green,n.blue,n.alpha];if(e===0){const s="#"+t.map(r=>(r&255).toString(16).padStart(2,"0")).join("").toUpperCase();return s.endsWith("FF")?s.slice(0,-2):s}return`rgba(${t.map((s,r)=>r===3?s/255:s).join(",")})`}const Ue=n=>new _r(n.left,n.top,n.right,n.bottom),ie=n=>({left:n.left,top:n.top,right:n.right,bottom:n.bottom});class _r{constructor(e,t,s,r){this.left=e,this.top=t,this.right=s,this.bottom=r}toCss(e){const{css_var_prefix:t,density:s}=wr(e);return[[`${t}left`,`${this.left/s}px`],[`${t}top`,`${this.top/s}px`],[`${t}right`,`${this.right/s}px`],[`${t}bottom`,`${this.bottom/s}px`]]}toCssText(e){return this.toCss(e).map(([t,s])=>`${t}:${s};`).join(" ")}setStyle(e,t){for(const[s,r]of this.toCss(t))e.setProperty(s,r)}effect(e){var a,i;const t=((a=e.css_var_prefix)==null?void 0:a.concat("<<prefix"))??((i=e.css_var_name)==null?void 0:i.concat("<<name"))??"default";let s=document.getElementById(t);s==null&&(s=document.createElement("style"),document.head.appendChild(s),s.id=t);let r=`:root {${this.toCssText(e)}}`;e.layer&&(r=`@layer ${e.layer} {${r}}`),s.innerHTML=r}}const wr=(n={})=>{const e=n.css_var_prefix??(n.css_var_name?`--${n.css_var_name}-inset-`:"--inset-"),t=n.density??window.devicePixelRatio;return{css_var_prefix:e,density:t}};var br=Object.defineProperty,mr=Object.getOwnPropertyDescriptor,Pr=(n,e,t,s)=>{for(var r=s>1?void 0:s?mr(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&br(e,t,r),r};class yt{constructor(e,t,s){this.plugin=e,this.fetcher=t,this.coder=s,this._signalCurrentStateChange=se(),this.onChange=this._signalCurrentStateChange.listen}async*jsonlines(e){const t=await h.public_url,s=new URL(t.replace(/^http:/,"ws:"));s.pathname=`/${this.plugin.mmid}/observe`;const r=new WebSocket(s);this._ws=r,r.binaryType="arraybuffer";const a=new ir;r.onmessage=async i=>{const l=i.data;a.controller.enqueue(l)},r.onclose=async()=>{a.controller.close()},r.onerror=async i=>{a.controller.error(i)};for await(const i of dt(a.stream.pipeThrough(new TextDecoderStream).pipeThrough(new at(this.coder.decode)),e))this.currentState=i,yield i}stopObserve(){var e;return(e=this._ws)==null||e.close(),this.plugin.fetchApi("/stopObserve")}get currentState(){return this._currentState}set currentState(e){this._currentState=e,e&&this._signalCurrentStateChange.emit(e)}async getState(e=!1){return e||this.currentState===void 0?await this._updateCurrentState():this.currentState}async _updateCurrentState(){const e=await this.fetcher();return this.currentState=this.coder.decode(e)}}Pr([o],yt.prototype,"getState",1);var Or=Object.defineProperty,Sr=Object.getOwnPropertyDescriptor,k=(n,e,t,s)=>{for(var r=s>1?void 0:s?Sr(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&Or(e,t,r),r};const B=class _t extends h{constructor(){super(...arguments),this.baseCoder={decode:e=>({...e,insets:Ue(e.insets)}),encode:e=>({...e,insets:ie(e.insets)})}}get state(){return new yt(this,()=>this.commonGetState(),this.coder)}async commonSetState(e){await this.fetchApi("/setState",{search:e}).ok()}async commonGetState(){return await this.fetchApi("/getState",{search:{rid:_t.rid_acc++}}).object()}get getState(){return this.state.getState}setOverlay(e){return this.setStateByKey("overlay",e)}async getOverlay(){return(await this.state.getState()).overlay}};B.rid_acc=1;k([c()],B.prototype,"state",1);k([o],B.prototype,"commonSetState",1);k([o],B.prototype,"commonGetState",1);k([o],B.prototype,"setOverlay",1);k([o],B.prototype,"getOverlay",1);let Ke=B;var Er=Object.defineProperty,Cr=Object.getOwnPropertyDescriptor,O=(n,e,t,s)=>{for(var r=s>1?void 0:s?Cr(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&Er(e,t,r),r};class y extends Ke{setColor(e){return this.setStateByKey("color",e)}async getColor(){return(await this.state.getState()).color}setStyle(e){return this.setStateByKey("style",e)}async getStyle(){return(await this.state.getState()).style}show(){return this.setVisible(!0)}hide(){return this.setVisible(!1)}setVisible(e){return this.setStateByKey("visible",e)}async getVisible(){return(await this.state.getState()).visible}setOverlay(e){return this.setStateByKey("overlay",e)}async getOverlay(){return(await this.state.getState()).overlay}}O([o],y.prototype,"setColor",1);O([o],y.prototype,"getColor",1);O([o],y.prototype,"setStyle",1);O([o],y.prototype,"getStyle",1);O([o],y.prototype,"show",1);O([o],y.prototype,"hide",1);O([o],y.prototype,"setVisible",1);O([o],y.prototype,"getVisible",1);O([o],y.prototype,"setOverlay",1);O([o],y.prototype,"getOverlay",1);var Dr=Object.defineProperty,Tr=Object.getOwnPropertyDescriptor,wt=(n,e,t,s)=>{for(var r=s>1?void 0:s?Tr(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&Dr(e,t,r),r};class Ge extends y{constructor(){super("navigation-bar.nativeui.browser.dweb"),this.coder={decode:e=>({...this.baseCoder.decode(e),color:ft(e.color,Xe.HEXA)}),encode:e=>({...e,color:ae(e.color),insets:ie(e.insets)})}}async setState(e){await this.commonSetState({...e,color:e.color?ae(e.color):void 0})}setStateByKey(e,t){return this.setState({[e]:t})}get getState(){return this.state.getState}}wt([o],Ge.prototype,"setState",1);wt([o],Ge.prototype,"setStateByKey",1);const v=new Ge;var $;class ve extends HTMLElement{constructor(t){super();N(this,$,void 0);this.state=t,(async()=>{for await(const s of t.jsonlines());})()}async connectedCallback(){L(this,$,this.state.onChange(t=>{this.dispatchEvent(new CustomEvent("statechange",{detail:t}))})),await this.state.getState(!0)}async disconnectedCallback(){E(this,$)&&(E(this,$).call(this),L(this,$,void 0)),await this.state.stopObserve()}}$=new WeakMap;var Ar=Object.defineProperty,Lr=Object.getOwnPropertyDescriptor,b=(n,e,t,s)=>{for(var r=s>1?void 0:s?Lr(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&Ar(e,t,r),r};class g extends ve{constructor(){super(v.state),this.plugin=v}get setColor(){return v.setColor}get getColor(){return v.getColor}get setStyle(){return v.setStyle}get getStyle(){return v.getStyle}get show(){return v.show}get hide(){return v.hide}get setVisible(){return v.setVisible}get getVisible(){return v.getVisible}get getState(){return v.getState}get setOverlay(){return v.setOverlay}get getOverlay(){return v.getOverlay}}g.tagName="dweb-navigation-bar";b([c()],g.prototype,"setColor",1);b([c()],g.prototype,"getColor",1);b([c()],g.prototype,"setStyle",1);b([c()],g.prototype,"getStyle",1);b([c()],g.prototype,"show",1);b([c()],g.prototype,"hide",1);b([c()],g.prototype,"setVisible",1);b([c()],g.prototype,"getVisible",1);b([c()],g.prototype,"getState",1);b([c()],g.prototype,"setOverlay",1);b([c()],g.prototype,"getOverlay",1);customElements.define(g.tagName,g);var jr=Object.defineProperty,$r=Object.getOwnPropertyDescriptor,bt=(n,e,t,s)=>{for(var r=s>1?void 0:s?$r(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&jr(e,t,r),r};const xr={_listeners:{},_windowListeners:{}};class Je extends We{constructor(){super(xr),this.handleOnline=()=>{const t={connected:!0,connectionType:rt()};this.notifyListeners("onLine",new Event("onLine")),this.notifyListeners("change",t)},this.handleOffline=()=>{const e={connected:!1,connectionType:"none"};this.notifyListeners("offLine",new Event("offLine")),this.notifyListeners("change",e)},typeof window<"u"&&(globalThis.addEventListener("online",this.handleOnline),globalThis.addEventListener("offline",this.handleOffline))}onLine(){return navigator.onLine}async getStatus(){if(!globalThis.navigator)throw Error("Browser does not support the Network Information API");const e=window.navigator.onLine,t=rt();return{connected:e,connectionType:e?t:"none"}}}bt([o],Je.prototype,"onLine",1);bt([o],Je.prototype,"getStatus",1);const Ur=new Je;function rt(){const n=window.navigator.connection||window.navigator.mozConnection||window.navigator.webkitConnection;let e="unknown";const t=n?n.type||n.effectiveType:null;if(t&&typeof t=="string")switch(t){case"bluetooth":case"cellular":e="cellular";break;case"none":e="none";break;case"ethernet":case"wifi":case"wimax":e="wifi";break;case"other":case"unknown":e="unknown";break;case"slow-2g":case"2g":e="2g";break;case"3g":e="3g";break;case"4g":e="4g";break;case"5g":e="5g";break;case"6g":e="6g";break}return e}var Br=Object.defineProperty,Nr=Object.getOwnPropertyDescriptor,mt=(n,e,t,s)=>{for(var r=s>1?void 0:s?Nr(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&Br(e,t,r),r};class G extends HTMLElement{constructor(){super(...arguments),this.plugin=Ur}get getStatus(){return this.plugin.getStatus}get onLine(){return this.plugin.onLine}}G.tagName="dweb-network";mt([c()],G.prototype,"getStatus",1);mt([c()],G.prototype,"onLine",1);customElements.define(G.tagName,G);var Mr=Object.defineProperty,Hr=Object.getOwnPropertyDescriptor,fe=(n,e,t,s)=>{for(var r=s>1?void 0:s?Hr(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&Mr(e,t,r),r};class ee extends Ke{constructor(){super("safe-area.nativeui.browser.dweb"),this.coder={decode:e=>({...this.baseCoder.decode(e),cutoutInsets:Ue(e.cutoutInsets),outerInsets:Ue(e.outerInsets)}),encode:e=>({...this.baseCoder.encode(e),cutoutInsets:ie(e.cutoutInsets),outerInsets:ie(e.outerInsets)})}}async setState(e){await this.commonSetState(e)}setStateByKey(e,t){return this.setState({[e]:t})}get getState(){return this.state.getState}setOverlay(e){return this.setStateByKey("overlay",e)}async getOverlay(){return(await this.state.getState()).overlay}}fe([o],ee.prototype,"setState",1);fe([o],ee.prototype,"setStateByKey",1);fe([o],ee.prototype,"setOverlay",1);fe([o],ee.prototype,"getOverlay",1);const M=new ee;var Ir=Object.defineProperty,Rr=Object.getOwnPropertyDescriptor,ye=(n,e,t,s)=>{for(var r=s>1?void 0:s?Rr(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&Ir(e,t,r),r};class x extends ve{constructor(){super(M.state),this.plugin=M}get getState(){return M.getState}get setState(){return M.setStateByKey}get setOverlay(){return M.setOverlay}get getOverlay(){return M.getOverlay}}x.tagName="dweb-safe-area";ye([c()],x.prototype,"getState",1);ye([c()],x.prototype,"setState",1);ye([c()],x.prototype,"setOverlay",1);ye([c()],x.prototype,"getOverlay",1);customElements.define(x.tagName,x);var qr=Object.defineProperty,Vr=Object.getOwnPropertyDescriptor,Pt=(n,e,t,s)=>{for(var r=s>1?void 0:s?Vr(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&qr(e,t,r),r};class ze extends h{constructor(){super("share.sys.dweb")}async canShare(){return!(typeof navigator>"u"||!navigator.share)}async share(e){const t=new FormData;if(e.files&&e.files.length!==0)for(let r=0;r<e.files.length;r++){const a=e.files.item(r);t.append("files",a)}return await this.buildApiRequest("/share",{search:{title:e==null?void 0:e.title,text:e==null?void 0:e.text,url:e==null?void 0:e.url},method:"POST",body:t,base:await h.public_url}).fetch().object()}}Pt([o],ze.prototype,"canShare",1);Pt([o],ze.prototype,"share",1);const Oe=new ze;class Be extends HTMLElement{constructor(){super(...arguments),this.plugin=Oe}get canShare(){return Oe.canShare}get share(){return Oe.share}}Be.tagName="dweb-share";customElements.define(Be.tagName,Be);var Wr=Object.defineProperty,Xr=Object.getOwnPropertyDescriptor,Ot=(n,e,t,s)=>{for(var r=s>1?void 0:s?Xr(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&Wr(e,t,r),r};class Fe extends h{constructor(){super("splash-screen.nativeui.browser.dweb")}async show(e){return await this.fetchApi("/show",{search:{autoHide:e==null?void 0:e.autoHide,showDuration:e==null?void 0:e.showDuration,fadeOutDuration:e==null?void 0:e.fadeOutDuration,fadeInDuration:e==null?void 0:e.fadeInDuration}}).boolean()}async hide(e){return await this.fetchApi("/hide",{search:{fadeOutDuration:e==null?void 0:e.fadeOutDuration}}).boolean()}}Ot([o],Fe.prototype,"show",1);Ot([o],Fe.prototype,"hide",1);const Se=new Fe;var Kr=Object.defineProperty,Gr=Object.getOwnPropertyDescriptor,St=(n,e,t,s)=>{for(var r=s>1?void 0:s?Gr(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&Kr(e,t,r),r};class J extends HTMLElement{constructor(){super(...arguments),this.plugin=Se}get show(){return Se.show}get hide(){return Se.hide}}J.tagName="dweb-splash-screen";St([c()],J.prototype,"show",1);St([c()],J.prototype,"hide",1);customElements.define(J.tagName,J);var Jr=Object.defineProperty,zr=Object.getOwnPropertyDescriptor,Et=(n,e,t,s)=>{for(var r=s>1?void 0:s?zr(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&Jr(e,t,r),r};class Ze extends y{constructor(){super("status-bar.nativeui.browser.dweb"),this.coder={decode:e=>({...this.baseCoder.decode(e),color:ft(e.color,Xe.HEXA)}),encode:e=>({...this.baseCoder.encode(e),color:ae(e.color)})}}async setState(e){await this.commonSetState({...e,color:e.color?ae(e.color):void 0})}setStateByKey(e,t){return this.setState({[e]:t})}get getState(){return this.state.getState}}Et([o],Ze.prototype,"setState",1);Et([o],Ze.prototype,"setStateByKey",1);const f=new Ze;var Fr=Object.defineProperty,Zr=Object.getOwnPropertyDescriptor,m=(n,e,t,s)=>{for(var r=s>1?void 0:s?Zr(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&Fr(e,t,r),r};class d extends ve{constructor(){super(f.state),this.plugin=f}get setColor(){return f.setColor}get getColor(){return f.getColor}get setStyle(){return f.setStyle}get getStyle(){return f.getStyle}get show(){return f.show}get hide(){return f.hide}get setVisible(){return f.setVisible}get getVisible(){return f.getVisible}get getState(){return f.getState}get setOverlay(){return f.setOverlay}get getOverlay(){return f.getOverlay}}d.tagName="dweb-status-bar";m([c()],d.prototype,"setColor",1);m([c()],d.prototype,"getColor",1);m([c()],d.prototype,"setStyle",1);m([c()],d.prototype,"getStyle",1);m([c()],d.prototype,"show",1);m([c()],d.prototype,"hide",1);m([c()],d.prototype,"setVisible",1);m([c()],d.prototype,"getVisible",1);m([c()],d.prototype,"getState",1);m([c()],d.prototype,"setOverlay",1);m([c()],d.prototype,"getOverlay",1);customElements.define(d.tagName,d);var Qr=Object.defineProperty,Yr=Object.getOwnPropertyDescriptor,kr=(n,e,t,s)=>{for(var r=s>1?void 0:s?Yr(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&Qr(e,t,r),r};class Ct extends h{constructor(){super("toast.nativeui.browser.dweb")}async show(e){const{text:t,duration:s="long",position:r="bottom"}=e;await this.fetchApi("/show",{search:{message:t,duration:s,position:r}})}}kr([o],Ct.prototype,"show",1);const st=new Ct;var es=Object.defineProperty,ts=Object.getOwnPropertyDescriptor,rs=(n,e,t,s)=>{for(var r=s>1?void 0:s?ts(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&es(e,t,r),r};class oe extends HTMLElement{constructor(){super(...arguments),this.plugin=st}get show(){return st.show}}oe.tagName="dweb-toast";rs([c()],oe.prototype,"show",1);customElements.define(oe.tagName,oe);var ss=Object.defineProperty,ns=Object.getOwnPropertyDescriptor,Dt=(n,e,t,s)=>{for(var r=s>1?void 0:s?ns(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&ss(e,t,r),r};class Qe extends h{constructor(){super("torch.nativeui.browser.dweb")}async toggleTorch(){return await this.fetchApi("/toggleTorch").boolean()}async getTorchState(){return await this.fetchApi("/torchState").boolean()}}Dt([o],Qe.prototype,"toggleTorch",1);Dt([o],Qe.prototype,"getTorchState",1);const Ee=new Qe;var as=Object.defineProperty,is=Object.getOwnPropertyDescriptor,Tt=(n,e,t,s)=>{for(var r=s>1?void 0:s?is(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&as(e,t,r),r};class z extends HTMLElement{constructor(){super(...arguments),this.plugin=Ee}get toggleTorch(){return Ee.toggleTorch}get getTorchState(){return Ee.getTorchState}}z.tagName="dweb-torch";Tt([c()],z.prototype,"toggleTorch",1);Tt([c()],z.prototype,"getTorchState",1);customElements.define(z.tagName,z);var os=Object.defineProperty,cs=Object.getOwnPropertyDescriptor,_e=(n,e,t,s)=>{for(var r=s>1?void 0:s?cs(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&os(e,t,r),r};class te extends Ke{constructor(){super("virtual-keyboard.nativeui.browser.dweb"),this.coder=this.baseCoder}async setState(e){await this.commonSetState(e)}setStateByKey(e,t){return this.setState({[e]:t})}get getState(){return this.state.getState}setOverlay(e){return this.setStateByKey("overlay",e)}async getOverlay(){return(await this.state.getState()).overlay}}_e([o],te.prototype,"setState",1);_e([o],te.prototype,"setStateByKey",1);_e([o],te.prototype,"setOverlay",1);_e([o],te.prototype,"getOverlay",1);const H=new te;var ls=Object.defineProperty,us=Object.getOwnPropertyDescriptor,we=(n,e,t,s)=>{for(var r=s>1?void 0:s?us(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(r=(s?i(e,t,r):i(r))||r);return s&&r&&ls(e,t,r),r};class U extends ve{constructor(){super(H.state),this.plugin=H}get getState(){return H.getState}get setState(){return H.setStateByKey}get setOverlay(){return H.setOverlay}get getOverlay(){return H.getOverlay}}U.tagName="dweb-virtual-keyboard";we([c()],U.prototype,"getState",1);we([c()],U.prototype,"setState",1);we([c()],U.prototype,"setOverlay",1);we([c()],U.prototype,"getOverlay",1);customElements.define(U.tagName,U);const be=document.querySelector("dweb-status-bar"),hs=document.querySelector("dweb-barcode-scanning"),ps=async n=>{var t;n.preventDefault();const e=document.getElementById("fileToUpload");if(e&&((t=e.files)!=null&&t[0])){const s=e.files[0];alert(await it.process(s))}},gs=async()=>{hs.startScanning()};async function ds(){alert((await be.getState()).color)}async function vs(){be.hide()}async function fs(){be.show()}be.addEventListener("statechange",n=>{console.log("statechange=>",n)});const ys=document.querySelector("dweb-virtual-keyboard");ys.addEventListener("statechange",n=>{console.log("virtualKeyBoard#statechange=>",n)});document.querySelector("dweb-haptics");document.querySelector("dweb-share");document.querySelector("dweb-toast");document.querySelector("dweb-device");document.querySelector("dweb-mwebview");const _s=async(n="今晚吃螃🦀️蟹吗？")=>{const t=document.getElementById("input1").value;console.log("sayHi=>",t),t&&(n=t);const s=await vt.externalFetch("game.dweb.waterbang.top.dweb",{pathname:"/say/hi",search:{message:n}});console.log("收到回应消息 => ",await s.text())};vt.addEventListener("fetch",async n=>{console.log("Dweb Service Worker fetch!",n);const e=new URL(n.request.url);if(e.pathname.endsWith("/say/hi")){const t=e.searchParams.get("message");return console.log(`收到:${t}`),n.respondWith("我是plaoc-html-demo 我接收到了消息")}return n.respondWith("Not match any routes")});Object.assign(globalThis,{sayHi:_s,statusBarGetColor:ds,handleSubmit:ps,hideStatusBar:vs,startScanning:gs,showStartBar:fs});
